You are a senior Python backend engineer helping me design and implement the data layer and ingestion jobs for my project **Vinilogy**.

Context:
- Tech stack: Python, PostgreSQL, httpx/requests for external APIs. I’m using Replit.
- Architecture: “modular monolith”.
- Main goal: build and populate a database with ~10k artists and their data, so later I can use this for vinyl recommendations with minimal external calls.

### VERY IMPORTANT BEHAVIORS

1. **Database is a “smart cache” and single source of truth**
   - When looking up an artist/album/release:
     - First query the DB.
     - If the entity is missing (**cache miss**):
       - Fetch it from Last.fm / MusicBrainz / Discogs / Spotify.
       - Insert all relevant data into the DB.
       - Then return the DB entity.
   - This cache-miss behavior must be fully reflected in the design and the code.

2. **Recommendation logic combines inputs**
   - Manual seed artists (first version).
   - Discogs data (collection, wantlist) when user connects Discogs.
   - Spotify/Last.fm listening data when user connects Spotify/Last.fm.
   - Recommendations are stored in DB (tables like `recommendation_sets` and `recommendation_items`).
   - The design must support combining signals from all sources.

3. **I need to store ALL vinyl releases (very important)**
   - For every album, I want to save **every single vinyl release** found on Discogs.
   - Not just one, not just the cheapest.
   - ALL vinyl editions: every country, every year, every pressing, every label, every variant.
   - The `releases` table will often contain dozens or hundreds of records per album.
   - The `album_best_price` table is only a derived layer to store “the cheapest per country”, but it does NOT replace the full list.
   - This requirement must be explicit in the ingestion pipeline and schema.

### DATA REQUIREMENTS

#### ARTISTS (store):
- id (internal)
- mbid
- discogs_id
- spotify_id
- name
- normalized_name
- image_url
- source (seed, lastfm, discogs, spotify…)
- timestamps

#### ARTIST SIMILARS:
- artist_id
- similar_artist_id
- score
- source
- At least 20 related artists per artist (use Last.fm).

#### ALBUMS (store):
- id (internal)
- mbid (MusicBrainz release-group)
- discogs_id (Discogs master)
- spotify_id
- artist_id (FK)
- title
- normalized_title
- first_release_year
- is_studio (boolean)
- timestamps

#### RELEASES (store ALL vinyl releases):
- id (internal)
- mbid (MusicBrainz release if available)
- discogs_id (Discogs release id)
- spotify_id (optional)
- album_id (FK)
- title
- country
- year
- format (Vinyl, 2xVinyl, etc.)
- is_vinyl (boolean)
- is_official
- label
- discogs_rating
- timestamps

#### PRICES:
- release_id (FK)
- provider
- country
- currency
- amount
- shipping_amount
- total_amount
- url
- fetched_at

#### ALBUM_BEST_PRICE:
- For each `(album_id, country)`, store the cheapest total price among all releases and providers.

### EXTERNAL APIS
- Last.fm → artist info + similar artists.
- MusicBrainz → studio albums via release-groups.
- Discogs → ALL vinyl releases of each album.
- Price providers → cheapest options.
- Spotify → IDs + listening history.

### LAST.FM IMAGE ISSUE (MUST DEBUG)
- Last.fm image URLs not loading.
- Plan:
  - Log full response from `artist.getInfo`.
  - Inspect `image` array.
  - Choose stable size (`mega`, `extralarge`).
  - Ensure HTTPS + correct URL encoding.
  - Provide a test script to verify image URLs.

### WHAT I NEED FROM YOU

1. **High-level implementation plan**, covering:
   - DB schema (tables + indexes).
   - Folder/module structure.
   - Migration strategy.
   - Full ingestion pipeline end-to-end.
   - Cache-miss behavior, explicit.
   - How to store ALL vinyl releases.

2. **PostgreSQL schema** (SQL or Alembic) for:
   - artists
   - artist_similars
   - albums
   - releases (ALL vinyl releases)
   - prices
   - album_best_price

3. **Python package structure**:
   - app/core
   - app/modules/artists
   - app/modules/albums
   - app/modules/releases
   - app/modules/prices
   - app/modules/integrations/{lastfm,musicbrainz,discogs,spotify}
   - app/modules/recommender

4. **Ingestion scripts**:
   - Seed artists from Last.fm.
   - Fetch studio albums from MusicBrainz.
   - Map albums to ALL vinyl releases from Discogs.
   - Prices + album_best_price.
   - Cache-miss helper (`get_or_create_artist_by_name`).

5. **Debug script for Last.fm images**.

Please start by summarizing your understanding, then generate the full plan and the code skeleton.
